<UserControl x:Class="CalendarMaker.Views.CoverPageView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:models="clr-namespace:CalendarMaker.Models"
             xmlns:vm="clr-namespace:CalendarMaker.ViewModels"
             UseLayoutRounding="True"
             SnapsToDevicePixels="True">

    <Border Background="White" SnapsToDevicePixels="True">
        <Grid>
            <!-- Fixed horizontal cover spec (A4横/A5横) -->
            <Canvas x:Name="SpecCanvas">
                <Canvas.Style>
                    <Style TargetType="Canvas">
                        <Setter Property="Visibility" Value="Collapsed"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding UseFixedHorizontalSpecLayout}" Value="True">
                                <Setter Property="Visibility" Value="Visible"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Canvas.Style>

                <ItemsControl ItemsSource="{Binding DecorLines}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <Canvas/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate DataType="{x:Type vm:CoverDecorLineViewModel}">
                            <Line X1="{Binding X1}"
                                  X2="{Binding X2}"
                                  Y1="{Binding Y}"
                                  Y2="{Binding Y}"
                                  Stroke="{Binding DataContext.TextBrush, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                  StrokeThickness="{Binding StrokeThickness}"
                                  SnapsToDevicePixels="True"/>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

                <ItemsControl ItemsSource="{Binding Tiles}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <Canvas/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemContainerStyle>
                        <Style TargetType="ContentPresenter">
                            <Setter Property="Canvas.Left" Value="{Binding X}"/>
                            <Setter Property="Canvas.Top" Value="{Binding Y}"/>
                        </Style>
                    </ItemsControl.ItemContainerStyle>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate DataType="{x:Type vm:CoverTileViewModel}">
                            <Border Width="{Binding W}"
                                    Height="{Binding H}"
                                    ClipToBounds="True">
                                <Border.Background>
                                    <!-- 横表紙タイルは 3:4 へ center-crop（UniformToFill） -->
                                    <ImageBrush ImageSource="{Binding ImagePath}"
                                                Stretch="UniformToFill"/>
                                </Border.Background>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

                <Border Canvas.Left="0"
                        Canvas.Top="{Binding TitleTop}"
                        Width="{Binding PageDipW}"
                        Height="{Binding TitleBoxHeight}"
                        Background="Transparent">
                    <TextBlock Text="{Binding Title}"
                               Foreground="{Binding TextBrush}"
                               FontFamily="Impact"
                               FontSize="{Binding TitleFontSize}"
                               FontWeight="Bold"
                               TextAlignment="Center"
                               VerticalAlignment="Center"/>
                </Border>

                <Border Canvas.Left="0"
                        Canvas.Top="{Binding SubtitleTop}"
                        Width="{Binding PageDipW}"
                        Height="{Binding SubtitleBoxHeight}"
                        Background="Transparent">
                    <TextBlock Text="{Binding Subtitle}"
                               Foreground="{Binding TextBrush}"
                               FontSize="{Binding SubtitleFontSize}"
                               TextAlignment="Center"
                               VerticalAlignment="Center"/>
                </Border>
            </Canvas>

            <!-- Legacy cover layout (portrait, etc.) -->
            <Grid x:Name="LegacyGrid" Margin="5">
                <Grid.Style>
                    <Style TargetType="Grid">
                        <Setter Property="Visibility" Value="Visible"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding UseFixedHorizontalSpecLayout}" Value="True">
                                <Setter Property="Visibility" Value="Collapsed"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Grid.Style>

                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <StackPanel Margin="0,10,0,12" HorizontalAlignment="Center">
                    <TextBlock Text="{Binding Title}"
                               Foreground="{Binding TextBrush}"
                               FontFamily="Impact"
                               FontSize="54"
                               FontWeight="Bold"
                               TextAlignment="Center"/>
                    <TextBlock Text="{Binding Subtitle}"
                               Foreground="{Binding TextBrush}"
                               FontSize="18"
                               Margin="0,4,0,0"
                               TextAlignment="Center"/>
                </StackPanel>

                <Grid Grid.Row="1">
                    <ItemsControl ItemsSource="{Binding Tiles}">
                        <ItemsControl.Style>
                            <Style TargetType="ItemsControl">
                                <Setter Property="Visibility" Value="Collapsed"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding LayoutType}" Value="{x:Static models:CoverLayoutType.Grid3x4}">
                                        <Setter Property="Visibility" Value="Visible"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </ItemsControl.Style>
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <UniformGrid Columns="3"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Margin="6"
                                        BorderBrush="#DDDDDD"
                                        BorderThickness="1"
                                        CornerRadius="4"
                                        Background="#F2F2F2"
                                        ClipToBounds="True">
                                    <Grid>
                                        <Border Margin="0"
                                                Height="{Binding ActualWidth, RelativeSource={RelativeSource Self}, Converter={StaticResource MultiplyConverter}, ConverterParameter=0.6666666667}"
                                                VerticalAlignment="Top"
                                                ClipToBounds="True">
                                            <Border.Background>
                                                <ImageBrush ImageSource="{Binding ImagePath}"
                                                            Viewbox="{Binding ImageCropRect}"
                                                            ViewboxUnits="RelativeToBoundingBox"
                                                            Stretch="UniformToFill"/>
                                            </Border.Background>
                                        </Border>

                                        <Border Background="#66000000"
                                                HorizontalAlignment="Left"
                                                VerticalAlignment="Top"
                                                Padding="6,2"
                                                CornerRadius="0,0,6,0">
                                            <TextBlock Text="{Binding Label}" Foreground="White" FontWeight="SemiBold"/>
                                        </Border>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>

                    <ItemsControl ItemsSource="{Binding Tiles}">
                        <ItemsControl.Style>
                            <Style TargetType="ItemsControl">
                                <Setter Property="Visibility" Value="Collapsed"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding LayoutType}" Value="{x:Static models:CoverLayoutType.Grid4x3}">
                                        <Setter Property="Visibility" Value="Visible"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </ItemsControl.Style>
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <UniformGrid Columns="4"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Margin="6"
                                        BorderBrush="#DDDDDD"
                                        BorderThickness="1"
                                        CornerRadius="4"
                                        Background="#F2F2F2"
                                        ClipToBounds="True">
                                    <Grid>
                                        <Border Margin="0"
                                                Height="{Binding ActualWidth, RelativeSource={RelativeSource Self}, Converter={StaticResource MultiplyConverter}, ConverterParameter=0.6666666667}"
                                                VerticalAlignment="Top"
                                                ClipToBounds="True">
                                            <Border.Background>
                                                <ImageBrush ImageSource="{Binding ImagePath}"
                                                            Viewbox="{Binding ImageCropRect}"
                                                            ViewboxUnits="RelativeToBoundingBox"
                                                            Stretch="UniformToFill"/>
                                            </Border.Background>
                                        </Border>

                                        <Border Background="#66000000"
                                                HorizontalAlignment="Left"
                                                VerticalAlignment="Top"
                                                Padding="6,2"
                                                CornerRadius="0,0,6,0">
                                            <TextBlock Text="{Binding Label}" Foreground="White" FontWeight="SemiBold"/>
                                        </Border>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </Grid>
            </Grid>
        </Grid>
    </Border>
</UserControl>
