<Window x:Class="CalendarMaker.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:CalendarMaker.ViewModels"
        xmlns:views="clr-namespace:CalendarMaker.Views"
        Title="Calendar Maker" Width="1400" Height="900">
    <Window.DataContext>
        <vm:MainViewModel/>
    </Window.DataContext>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="420"/>
        </Grid.ColumnDefinitions>

        <!-- 左：プレビュー -->
        <DockPanel Grid.Column="0" Background="#ECEFF1">
            <StackPanel Orientation="Horizontal" DockPanel.Dock="Top" Margin="8">
                <TextBlock Text="ページ:" VerticalAlignment="Center" Margin="0,0,6,0"/>
                <ComboBox Width="160" ItemsSource="{Binding Pages}" SelectedIndex="{Binding SelectedPageIndex}">
                    <ComboBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding Month, StringFormat={}{0}月}"/>
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>

                <TextBlock Text="  ズーム:" VerticalAlignment="Center" Margin="12,0,6,0"/>
                <Slider x:Name="ZoomSlider" Minimum="0.2" Maximum="2.0" Value="0.70" Width="200"/>
            </StackPanel>

            <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto" Background="#ECEFF1">
                <Grid>
                    <Grid HorizontalAlignment="Center" VerticalAlignment="Top" Margin="24"
                RenderTransformOrigin="0.5,0.0">
                        <Grid.RenderTransform>
                            <ScaleTransform ScaleX="{Binding ElementName=ZoomSlider, Path=Value}"
                              ScaleY="{Binding ElementName=ZoomSlider, Path=Value}"/>
                        </Grid.RenderTransform>
                        <Grid.Effect>
                            <DropShadowEffect BlurRadius="18" ShadowDepth="4" Opacity="0.35"/>
                        </Grid.Effect>

                        <Border BorderBrush="#9AA0A6" BorderThickness="1" CornerRadius="4" Background="White">
                            <Grid>
                                <views:MonthPageView DataContext="{Binding CurrentPage}"/>
                                <!-- プレビュー用安全マージンガイド（必要なければ削除） -->
                                <Rectangle IsHitTestVisible="False" Stroke="#55FF4081" StrokeThickness="1"
                           StrokeDashArray="4 3" Margin="80,80,80,80"/>
                            </Grid>
                        </Border>
                    </Grid>
                </Grid>
            </ScrollViewer>
        </DockPanel>

        <!-- 右：設定 -->
        <ScrollViewer Grid.Column="1" VerticalScrollBarVisibility="Auto">
            <Border Padding="12">
                <StackPanel>
                    <StackPanel.Resources>
                        <Style TargetType="FrameworkElement">
                            <Setter Property="Margin" Value="0,6,0,0"/>
                        </Style>
                    </StackPanel.Resources>

                    <TextBlock Text="設定" FontWeight="Bold" FontSize="16"/>

                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="開始月" Width="70" VerticalAlignment="Center"/>
                        <DatePicker SelectedDate="{Binding StartMonthDateTime, Mode=TwoWay}"/>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="開始曜日" Width="70" VerticalAlignment="Center"/>
                        <ComboBox Width="150"
                      ItemsSource="{Binding StartWeekdayOptions}"
                      SelectedItem="{Binding Settings.StartWeekday}"/>
                    </StackPanel>

                    <Separator/>

                    <TextBlock Text="月別画像（開始月から順）" FontWeight="Bold"/>
                    <ItemsControl ItemsSource="{Binding Settings.MonthImagePaths}" AlternationCount="12">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Width="70"
                             Text="{Binding RelativeSource={RelativeSource AncestorType=ContentPresenter},
                                            Path=(ItemsControl.AlternationIndex),
                                            Converter={StaticResource IndexPlusOneConverter},
                                            StringFormat=画像{0}}"/>
                                    <TextBox Text="{Binding ., Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="270"/>
                                    <Button Content="参照..." Width="60" Margin="6,0,0,0"
                          Tag="{Binding RelativeSource={RelativeSource AncestorType=ContentPresenter}, Path=(ItemsControl.AlternationIndex)}"
                          Click="PickImage_Click"/>
                                </StackPanel>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>

                    <Separator/>
                    <TextBlock Text="フォント" FontWeight="Bold"/>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="見出し" Width="60"/>
                        <ComboBox Width="220" ItemsSource="{x:Static Fonts.SystemFontFamilies}"
                      SelectedItem="{Binding Settings.HeaderFont}"/>
                        <TextBox Width="60" Text="{Binding Settings.HeaderFontSize}"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="本文" Width="60"/>
                        <ComboBox Width="220" ItemsSource="{x:Static Fonts.SystemFontFamilies}"
                      SelectedItem="{Binding Settings.BodyFont}"/>
                        <TextBox Width="60" Text="{Binding Settings.BodyFontSize}"/>
                    </StackPanel>

                    <Separator/>
                    <TextBlock Text="記念日" FontWeight="Bold"/>
                    <StackPanel Orientation="Horizontal">
                        <DatePicker x:Name="AnnivDate"/>
                        <TextBox x:Name="AnnivLabel" Width="180"/>
                        <Button Content="追加" Click="AddAnniv_Click"/>
                    </StackPanel>
                    <ListBox ItemsSource="{Binding Settings.Anniversaries}" Height="120" DisplayMemberPath="Label"/>

                    <Separator/>
                    <StackPanel Orientation="Horizontal">
                        <Button Content="再生成" Width="100" Click="Rebuild_Click"/>
                        <Button Content="PDF出力" Width="100" Margin="8,0,0,0" Click="ExportPdf_Click"/>
                        <Button Content="印刷" Width="100" Margin="8,0,0,0" Click="Print_Click"/>
                    </StackPanel>
                </StackPanel>
            </Border>
        </ScrollViewer>
    </Grid>
</Window>
